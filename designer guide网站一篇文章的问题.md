ADC的噪声仿真
http://www.designers-guide.org/上有好几篇优秀的文章讲解一些模拟电路与EDA的使用。不过有一篇讲在device级仿真delta-sigmaADC噪声的文章，我感到还是有问题的。
设计delta-sigmaADC的人都知道，想在device级直接用仿真器得到等效噪声是很困难的事情。noise仿真是不行的，由于有比较器，pnoise也不行。仿真速度太慢，tran noise也效率不够。没有了仿真器的验证，单靠手算，又无法double check。在这个意义上看，那篇文章的想法是不错的，只考虑第一级，把比较器去掉，就可以用pnoise进行仿真了。
但是它存在两个问题。首先这个模型里没有包括vref的效果。vref噪声的影响是比较难于用简单手算得到的，因此有时希望用仿真来验证一些想法。但这个模型里就无法加入vref的噪声。（btw，vref的噪声会怎样影响，vref通路上的开关如何引入ktc噪声，两者关系如何，这些问题挺考验设计者对噪声对系统的理解）
其次，用文中的方法仿真得到的结果与手算的差一倍。手算应该是多少，其实也有人有不同看法，我是根据schreier附录里的思想分析得出的。然后用这个文章里的模型验证，发现仿真结果刚好少一半。哪里出了问题？分析了一下，我认为还是仿真出了问题。开关电容电路里有两种架构，一种是通常所见，另一种是flip 结构，采样电容在第二相被背在opa上。在delta-sigma里ref反馈的电容在第二相不是被背在opa上，而是被背在opa的输入和比较器的输出。但是在该文章里由于省略了比较器和第二级积分器，就变成了背在opa的输入和输出。通过一些简单的计算可以知道，这刚好就造成了一半的噪声丢失（这也是一个常识，即这种flip结构的好处），所以理论和仿真可以达成一致了。
由此可见，有时候简化的不恰当，是会导致根本性的差异。但这也不是说手算就一定比仿真好。比如有人就记住了ktc噪声，但是这个c应该用哪个，如果是两级opa如何考虑，vref反馈和采样电容合并或不合并情况下如何计算这些细致的问题如果没有能分析清楚，记住一个ktc的结果也就是无意义的了。
 

