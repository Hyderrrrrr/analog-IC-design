Bandgap设计（二）
这个世界有时候很奇怪。
以前blog里曾经说过，bandgap从反馈角度讲，基本上有两种，一种是负反馈，例如利用运放虚地特性，将两个电位钳制，另一个种是正反馈，利用电流镜特性使两个电位相等。这两种在razavi的书上刚好给了两种例子，以前做设计时也基本就是这两种电路结构。
但是今年年初时，看到了另一种电路，很像电流镜结构的bandgap。通常的电流镜结构是上面两个电流镜，下面两个准电流镜，互相耦合），这里上面不是电流镜而是电流源，同时又多出一条支路，构成一个cs放大器，产生的电流去偏置上面的两个电流源。刚看到这个电路时由于不熟悉，觉得很新奇。从反馈的角度讲，似乎是反馈回来两个电流信号，而这两个电流信号又通过下面的准电流镜发生作用，那么到底该如何分析呢？
根据神奇的墨菲定律，之后我又不停的碰到这种结构和它的变形。而且周围忽然有很多人在用这种结构。终于前几天才知道这种结构的名字叫brokaw，而且可以在jssc(1974)上找到原始的文献。看了jssc上的文献才有豁然开朗的感觉，原来事情的发展都是有它的规律的，我们觉得突然是因为我们跳跃的太多了。
其实仔细研究jssc上的文章可以发现，原始文献中的结构和bbs上给出的并不一样。但是如果我们掌握了分析方法，就能忽略这些不一致的地方，关注内在的一致性。
  
这种结构特别之处就在于它有三个支路，和之前的比似乎多了一个支路。但实际上如果我们考察用运放的结构，就可以发现其实那种结构也是三个支路，两个反馈环路互相耦合。所以从这个角度讲，这种结构和运放的异曲同工。jssc上那篇文章就是利用这个说法去分析的。它认为那些管子构成了一个两输入的运放，而运放的目的就是使bipolar上的电流相等。这个运放和我们之前看到的有所区别，主要就是它的两个输入是不对称的。不用运放的概念也可以用反馈的概念，两个输入点，一个输出点，两个输入点分别相对输出点为同相和反相，只要整个环路负反馈强于正反馈就可以使系统稳定下来。
还可以从另一个角度去看这个结构。假如去掉第三个支路，就和接近我们平时习惯的结构。但是还是有一些差别的，那就是系统中有高阻点，整个系统是不能稳定的（这个稳定是指系统中各个点的dc电位是不能确定的）。我们平时的结构可能是将电流源中的一个接成二极管形式。但实际上电流镜也不一定非要把其中的一个接成二极管形式，我们知道还可以用运放的形式去使得两个管子电流相等且一边电位固定。从这个角度看，那个第三支路其实就是一个单端运放，而它与对应的两个管子和起来就是一个电流镜。如果从这个角度看，这种结果其实就是变形的双电流镜结构。而且用这个方法去看电阻应该放在哪边就非常简单了。
进一步延伸，以前我们理解运放结构的bandgap，认为它是两个反馈回路。其实也可以理解成它和上部的器件一起构成了一个电路，而这个电路的特性就是出来两个一样的电流，且节点电压一样。再看电流镜形式的bandgap，也是出来两个一样的电流，这种理解就把正反馈和负反馈这些都隐藏在了电路的上部的实现细节中。
说了这么多，其实只是理清了电路的结构，以后看到这种电路可以很快的判断电阻应该放在哪边。除此之外其实还有一个别的收获。为什么要做这种结构呢？仔细一想可以知道，如果我们用电流镜，那么电流镜两个drain端的压差可能会比较大，所以一般用cascode结构。如果我们用opa做的电流镜，就可以比较自由的调节drain的电压（低电压下我曾经用过这种结构）。这里也是一样的，用了这种结构，虽然多了一路电流，但是电流镜drain的电压更加接近，就相当于用了cascode。不过换句话说，能用cascode，也就省了这一路的电流（如果是自偏置的cascode）。
 

