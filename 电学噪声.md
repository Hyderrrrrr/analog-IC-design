# 电学噪声
这里强调一下，是电学噪声。因为噪声的广义概念，就是一切非信号，包括了干扰。而这里说电学噪声，主要是指电路内部本征的噪声，这种东西除非你降低温度到绝对零度（不可能），否则一直存在。而干扰，则可以在理论上通过加屏蔽去除，量化噪声也可以通过更精细的量化减小。
对于电学噪声，课本上专门有一章讲。如果不深入考虑，那课本上讲的就足够工程师平时使用了。因为对于噪声，无非那么几个概念：噪声源是什么，有多大，通过线性时不变网络后如何计算。再深入一些，就是计算时如何考虑噪声的相关性，噪声带宽如何理解，等效输入噪声和输出噪声如何理解。（我想起我以前做课题时一直在想的一个问题，不知有人能否解答：对于成像系统，一般考虑接收二极管上有shot noise，其机制是载流子通过势垒时的随机性。但在一些论文中还看到，光子本身也有光子噪声，其表达式与shot noise很接近。那么电路里接收到的电信号噪声是两者功率和还是只有一个？这实际是说这两个噪声的物理机制是否具有相关性。由于不是搞光学，而且一般这种噪声都不在总噪声中占主导，因此我也只是想了想，没有结论，也没有找相关论文）。
但是由于现在讨论的电路不仅仅是线性时不变的，例如开关电容电路。因此目前课本里讨论的那些噪声理论就显得太单薄。而要更深入讨论噪声，一些基本理论又是绕不过去的，所以很是麻烦。下面就结合我自己的理解讲讲这个问题。
单纯的开关电容电路其实还算简单。作为近似求解，而不考虑线性周期时变的理论，用传统的方法就可以解释基本所有问题。和线性时不变电路最大的不同，开关电容电路存在采样过程。采样对信号的影响比较简单，就是引入了混叠。那么对噪声来说也是一样的。这就是为什么开关电容分析里一提到噪声，就先算一个RC电路，然后求噪声积分，得到kt/C，高兴的通知大家，看电容上噪声是kt/C。学生们也就兴高采烈的记住了，碰到一个电容就用kt/C。这样好记是好记，但是假如一个C两个开关，交替切换，该是多少呢？两个c两个开关交替呢？之前就有人在论坛上问过这类问题。当时我给了答案，但是没给太具体过程，所以似乎没太大说服力。这里我具体说明一下原理。
首先看采样过程，采样对信号是混叠的过程，对噪声也一样。所以带外的噪声全部进入带内。而对于采样，只有一个fs的频谱需要考虑（具体可见信号系统之类的书），所以总噪声一种算法是在采样后的一个fs中积分，另一种算法是在采样前对所有频带积分，两种必然是一样的。注意这里是说采样，而不是采样保持。所以这个噪声的含义就是如果我们去看c上的电压值，每个周期看一眼，就得到一个离散的序列，这个序列有自己的功率谱密度特性，有自己的离散特性。由于这个电压值也是和电荷值相关联的，而电荷守恒对噪声也是成立的（换句话说，一个电容放在那里，上面的电压是不会忽高忽低变化的），所以我们完全可以用离散域的传递函数继续计算这个噪声传递到后级的效果。（换句话，只有采样这个过程是特殊的，之后就不用考虑采样的效果）。
从这个过程分析的一个推论就是，电荷上什么时候有多大的噪声，取决于对这个电荷如何做采样（想一想sc电路中c接运放输入端那里什么时候做采样？大家可以看看delta-sigma数据转换器那本书里是如何分析的）。
刚才的分析里强调了采样和采样保持。严格说这两个是有重大区别的，采样是把连续信号离散化，而采样保持是把连续信号接着连续化，所以其实等效于两个过程：采样，线性时不变系统。之所以强调这个，是因为如果你问一个电容上的噪声是多少，就得反问你，你是关心采样的噪声还是采样保持的噪声。前者已经说过了，是每个周期去看一眼，后者则是不停的去看。所以两者的算法是不同的。假如一个开关和c串联，开半个周期，关半个周期，而又关心采样保持的噪声，该如何去算？严格说这是一个时变过程，不过由于简单，也可以直接分成两个过程算，前半个过程是一个连续电路的算法，后半个过程是采样保持的算法，最后总噪声就是两个过程的总和（在temes的那本模拟信号处理里有具体的计算过程）。
总结一下，在sc电路里，作为近似算法，可以把系统拆成采样，采样后的离散信号处理，采样后的连续信号处理三个部分。一旦过了采样，就和传统的线性时不变系统处理方法完全一样。而采样，就是混叠的过程。这样就把这个系统转换为了我们熟悉的系统，而唯一要做的就是找出系统是在哪里采样。
但是除了sc电路，我们似乎没那么好的运气了，例如vco的噪声。所以又发展出了对线性周期时变系统的分析方法，那么线性周期时变电路的噪声，也应该用这个方法才对。从理论上来说，对sc电路用线性周期时变是最准确的，不过这样也就只有数值解了。从实践上来说，两种方法对sc电路应该得到差不多的结论才对。根据我以前的仿真结果，要完全匹配是不现实的，但是数量级是没问题的（要求似乎太低，看到80年代有文献做过实际测量与传统理论的对比，是可以基本对上的）。我用pss+pnoise，有时有感觉这种仿真过于敏感，以至于不敢相信是实际电路真的如此还是算法不够稳健（没敢做两个对比电路流片，否则可以就此搞个研究了）。
pss的原理就是既然电路是线性的，那么传统上线性时不变系统只需要一个不变的传递函数就可以描述，现在就只需要一个周期变化的传递函数。所以pss需要算出一个周期的所有静态工作点，而pnoise就利用所有的静态工作点去求解。pnoise与noise分析还有一个小区别，就是pnoise里可以自动做采样，针对vco电路，又可以区分噪声的各种成分，这和noise很单纯的一个分析是不同的。
现在一种新的仿真方法是tran noise。就是在瞬态仿真时加入噪声。这种与前面的仿真方法有本质的区别。我还从来没有在大规模仿真中用过这种方法，一个问题是会是单纯的tran仿真变慢，另一个问题是可信度还没有得到完全确认（我记得曾经用几个不同的工具做同样的tran noise仿真，结果区别很大，当然也不排除有的工具没有设置好）。 

