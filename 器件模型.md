开关电容电路又该如何归类呢？在这个电路里，有开关的采样，也有时不变的运放。偷懒一点说，自然是周期时变了。不过这就失去了很多可以使用的技巧。所以不如认为它是时不变系统与采样系统的结合。连续信号经过采样，变成离散信号，离散信号经过离散信号处理，在输出被保持系统变为连续信号。这样每一步我们都会处理，从而简化的分析。但是这里的难点就在于寻找采样的边界。 
# 器件模型
如果所有的mos都在饱和区遵守I=1/2μ*Cox*W/L*（vgs-vth）^2这个公式，也许天下太平，模拟工程师就可以和数字工程师一样直接写代码，一天做成百上千个运算放大器了，spice会没人要，bsim小组也可以解散了。
可惜事实不是这样。先说最基本的修正吧。上面公式里没有vds，意味着饱和区vds增加电流不变，也等效输出阻抗ro无穷大。这和实际不符（虽然模拟电路设计者很希望这样）。现实中最早修正了一项（1+lamda*vds)，这个公式似乎是从双极中借鉴来的。进一步，又把lamda和管子的L以及电流做了关联，保证L越大，电流越小，ro越大。在有的文章中提到做模型参数提取时判断依据是I-V曲线的rms误差最小。但是ro是I-V曲线的导数，因此当rms误差最小时，未必ro很准。由此看来gm应该也有类似的问题。不过好在我们通常依赖的是很大的gm*ro做负反馈，而gm-C滤波器中也常常要校准，所以不准就不准。
再就是大尺寸工艺下下名义宽长和实际宽长是有差别的，这就导致如果需要精确匹配，必须使用同样的宽长，只是改变管子数目。在小尺寸工艺下w和l会影响vth（对其他各个参数也有影响，但对vth的影响最有名）。至于vth是随w和l变大还是变小，貌似不同工艺还不一样。对模拟工程师来说，这个效应一般都是想避免而不是想利用。于是大家就用较大的w和L，避免很小的delta引入很大的匹配误差。至于多少算合适，如果没有定量的数据，那只能是个人凭经验（感觉）了。曾经有教授说5倍的最小沟长，也有文章认为最小沟长没任何匹配问题。
另一个著名的效应可以算速度饱和。这是针对横向电场（vds）而言。电场增加，一般载流子的速度也会增加，但是当电场增大到一定程度后，载流子速度基本不变，电流也就随之不增加。对设计者而言，外在的表现就是器件特性变化了：从电流随vgs-vth平方变化改为了线性变化。如果单纯这样变也没什么，但实际中是平方率和线性关系的混合。在最简单模型中可以定义vdsat=vgs-vth，就是vds超过vdsat电压，对I的影响就减弱了。当时是由于夹断效应。现在仍然可以定义饱和电压vdsat，不过这个就是速度饱和引起的饱和电压与vgs-vth的混合体。所以vdsat与vgs-vth就不再有直接关系。但是大趋势还是一致的。
再进一步的修正，有DIBL效应（这个效应主要在亚阈值区提）。这个名字很酷，意思也很简单，漏致感应势垒降低，就是加上vds之后，vds越大，对应的vth越小。这反映在I vs. vds的曲线上，就是让曲线进一步上翘，等于减小了ro。
说到这里，应该是很多人经常问的，怎么vdsat不等于vgs-vth啊。如果用我上面的解释仍然有不足。在有些时候，即使采用最简单的模型（没有考虑速度饱和效应），等式也不成立。这是由于我们经常提的平方率公式仍然有一些简化。Mos器件的模型有多种，不同的模型近似程度不同，考虑的细节不同，甚至出发点也不同。但大多数都是从文章开头提到的level1 平方率公式演化而来，为了更接近真实情况，改用更复杂的模型公式，所以vdsat不等于vgs-vth是常态。常用的bsim公式中给出了vdsat的定义，是一个很复杂的表达式，不过核心思想还是上面的一些东西。同样，vth也有自己的定义，类似的参数包括gm，ro。仿真器在计算时会算出这些值，一般在DC分析时可以直接看到。估计如果谁有心把bsim的公式按定义重新计算一遍，理论上应该和仿真器给出的值是一样的。不过这等于重新实现了一遍仿真器的DC功能。
版图效应也被器件模型考虑。最早期时为了计算电容，会有源漏面积周长等参数，这相对容易理解。后来版图的影响越来越大，出现了新的参数sa，sb，sc。这是由LOD效应提取出来的几个参数，对应栅到有源区边缘的距离。LOD指length of diffusion effect，栅到有源区边缘距离不同，会有不同应力，从而器件特性不同。这个参数使得把几个并联的mos管单独画和合并画结果有所差异。换句话说，m和finger是不等效的。这曾经坑了我们一个项目。可以想到，如果用共享有源区的方法，ABBA结构虽然中心对称但一定是不匹配的，ABAB反而是对称的。这与以前教科书上的说法完全不同（以前做ABBA，考虑到电容也是不匹配的，但DC参数还是匹配的）。要部分解决也可以通过加dummy的方法使得这几个参数影响不那么大。
到了65nm工艺，又出来了WPE，well proximityeffect，指阱到有源区边缘距离不同导致器件特性不同。提取出的是sca,scb,scc。这个公式比之前的sa系列复杂多了，不过可以大致理解为对应者有源区和栅到阱的距离，距离越大，参数越不重要。如果距离太近，影响会急剧增加。在设计中，这个对vth影响很大。所以画版图更麻烦了，匹配更难做了，后仿也更重要了。

 

