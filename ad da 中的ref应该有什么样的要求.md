AD DA的REF设计
以前做过一段时间的ad和da，但是对于reference应该有什么样的要求一直没有从理论上想透彻，只是说如果仿真没问题就可以了。查了一些书与文献，似乎也很少有专门讨论这个的。前两天，前同事过来问这个问题，于是边讨论边分析，觉得反而把以前一些没想通的问题连贯了起来，逐渐条理化了一些，因此在这里先初步写一些。
先说明一下，这里主要还是定性半定量的讨论，至于定量的结果，一定还是以瞬态仿真为依据了，因为读者也可以发现，在下面的讨论中有比较多的近似。
先说ref对ad和da有什么影响。无非就是两种，一种是谐波，一种是噪声。在这里必须强调一下，ad和da的结果与ref不是线性关系，而是乘积关系，因此谐波和噪声的出现是一个非线性的过程。从数学上看，输出y=输入x*Vref（或者是除以，但在小信号下把除法变换成乘法，分析起来相对简单）。如果vref不是一个恒定值，一种是vref本身有与x无关的噪声成分，另一种是vref有与x有关的成分，那么产生了噪声和谐波。
先说vref里有噪声，那么假如x是正弦波，就等于噪声被信号卷积到了信号附近，且一个特性是信号越大，引入的噪声越大。根据这个，应可以算出ref中噪声的要求。不过根据我以前的数值计算，这部分的影响不是那么明显（当然也看个人的系统是什么样子的）。对于奈奎斯特AD，这里的算法都很简单。对于delta-sigma AD，算法就比较麻烦，因为存在带外信号的影响和过采样的影响。简单想，就是即使没有信号，带外依然有较大的信号，这些信号会把ref上的噪声送到带内。但是送入多少又与噪声本身的形状有关，假如是白噪声，应该能得到一个表达式，并且这个表达式与带外信号的总能量成正比。
vref里不仅仅有噪声，还有可能大小与信号有关，因此就有谐波项产生。对于delta-sigma,带外有大量的能量，那么那些能量的谐波也可以进入带内以噪声的样子出现。那么哪些情况下会使得vref与信号相关呢？与电路结构有关，与vref的设计有关。一般ad da都是开关电容电路，那么就有与信号无关的设计和与信号有关的设计两种电路，这两种电路在vref上抽取的电荷是不同的。即使与信号无关的设计，由于非理想因素的存在，也多多少少会抽取不同的电荷。而从ref的角度看，如果本身是个理想电压源，那么即使抽取的电荷每次不同，也应该保证vref是个常量。但实际上ref无非做成理想电压源，特别是高速情况下。所以从这个角度看，保证ref的输出电阻在对应的信号频率下足够小就是必要的。
但是我们平时不是都是用带宽去讨论速度的吗？比如一般都要求ref在电容上建立到0.5个lsb的精度以下等等。这就等于要求refbuf的带宽。这与输出电阻的分析是否一致呢？目前我还没有仔细推导，但是感觉应该是一致的，因为两者的分析是同源的，都是基于小信号分析得出的。对于一级opa，应该没有任何问题。对于两级opa，分析似乎有些复杂，暂且留在这里。对于这个问题，最近的思考结论居然是：其实速度与带宽并非直接关系，而主要是与输出电阻有关，带宽通过影响输出电阻间接影响了速度。这个结论很奇怪，但是推导过程却不复杂，只要把小信号框图画出来就可以看到由于输入为dc，因此反映输入项的gm是不存在的，只有输出电阻在图中。当周期接入负载后，实际是一个周期线性过程，可以近似用周期近似法，等效成两个阻抗分压（这个近似是否有效，在多大范围内有效?这是一个新问题）
 

